- name: Configure OPNsense VM
  hosts: mgmt_kvm
  become: yes
  tasks:
    - name: Deploy config.env
      copy:
        dest: "/var/lib/libvirt/vm_config/opnsense/config.env"
        # Figure out how to variablize the WAN_SUBNET later
        content: |
          OSDC1_MAC="{{ osdc.osdc1.mac_address }}"
          WAN_IP="{{ vms.opnsense.wan_ip }}"
          WAN_GATEWAY="{{ customer_network.gateway }}"
          WAN_SUBNET="{{ customer_network.subnet }}"
          NTP_TIMESERVERS="{{ ntp.server }}"
          NTP_PREFER="{{ ntp.server }}"
          OPNSENSE_HOSTNAME="opnsense"
          OPNSENSE_DOMAIN="{{ domain_name }}"
          INTERFACE_WAN="vtnet1"
          INTERFACE_LAN="vtnet0"
          INTERFACE_OPT1="vtnet2"
        owner: root
        group: root
        mode: "0644"
