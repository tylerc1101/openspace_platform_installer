<?xml version="1.0"?>
<opnsense>
  <theme>opnsense</theme>
  
  <!-- System Configuration -->
  <system>
    <optimization>normal</optimization>
    <hostname>{{ opnsense.hostname }}</hostname>
    <domain>{{ domain_name }}</domain>
    <dnsallowoverride>1</dnsallowoverride>
    
    <group>
      <name>admins</name>
      <description>System Administrators</description>
      <scope>system</scope>
      <gid>1999</gid>
      <member>0</member>
      <priv>page-all</priv>
    </group>
    
    <user>
      <name>root</name>
      <descr>System Administrator</descr>
      <scope>system</scope>
      <groupname>admins</groupname>
      <password>$2y$11$ppIBzuQ9vdrnrnim2lofSuYJuA..OOAdeN0JhE8zo1QpamrYLp9zS</password>
      <uid>0</uid>
      <expires/>
      <authorizedkeys/>
      <otp_seed/>
    </user>
    
    <nextuid>2000</nextuid>
    <nextgid>2000</nextgid>
    <timezone>{{ opnsense.timezone }}</timezone>
    <timeservers>{{ ntp.server }}</timeservers>
    
    <webgui>
      <protocol>https</protocol>
      <ssl-certref>67293f300ae55</ssl-certref>
      <port>{{ opnsense.webgui_port }}</port>
      <ssl-ciphers/>
      <interfaces/>
      <compression/>
    </webgui>
    
    <disablenatreflection>yes</disablenatreflection>
    <usevirtualterminal>1</usevirtualterminal>
    <disableconsolemenu>1</disableconsolemenu>
    <disablevlanhwfilter>1</disablevlanhwfilter>
    <disablechecksumoffloading>1</disablechecksumoffloading>
    <disablesegmentationoffloading>1</disablesegmentationoffloading>
    <disablelargereceiveoffloading>1</disablelargereceiveoffloading>
    <ipv6allow>1</ipv6allow>
    <powerd_ac_mode>hadp</powerd_ac_mode>
    <powerd_battery_mode>hadp</powerd_battery_mode>
    <powerd_normal_mode>hadp</powerd_normal_mode>
    <bogons>
      <interval>monthly</interval>
    </bogons>
    <pf_share_forward>1</pf_share_forward>
    <lb_use_sticky>1</lb_use_sticky>
    <ssh>
      <group>admins</group>
      <noauto>1</noauto>
      <interfaces/>
      <kex/>
      <ciphers/>
      <macs/>
      <keys/>
      <keysig/>
    </ssh>
    <rrdbackup>-1</rrdbackup>
    <netflowbackup>-1</netflowbackup>
    <firmware version="1.0.1">
      <mirror/>
      <flavour/>
      <plugins/>
      <type/>
      <subscription/>
      <reboot/>
    </firmware>
    <serialspeed>115200</serialspeed>
    <primaryconsole>video</primaryconsole>
    <language>en_US</language>
    <dnsallowoverride_exclude/>
    <dnsserver/>
    <dns1gw>none</dns1gw>
    <dns2gw>none</dns2gw>
    <dns3gw>none</dns3gw>
    <dns4gw>none</dns4gw>
    <dns5gw>none</dns5gw>
    <dns6gw>none</dns6gw>
    <dns7gw>none</dns7gw>
    <dns8gw>none</dns8gw>
  </system>

  <!-- Network Interfaces -->
  <interfaces>
    <wan>
      <if>{{ opnsense.wan_interface }}</if>
      <descr/>
      <enable>1</enable>
      <spoofmac/>
      <ipaddr>{{ opnsense.wan_ip }}</ipaddr>
      <subnet>{{ customer_network.cidr | regex_replace('^/', '') }}</subnet>
      <gateway>WAN_GW</gateway>
    </wan>
    
    <lan>
      <enable>1</enable>
      <if>{{ opnsense.lan_interface }}</if>
      <ipaddr>{{ mgmt_network.gateway }}</ipaddr>
      <subnet>{{ mgmt_network.cidr | regex_replace('^/', '') }}</subnet>
      <ipaddrv6/>
      <subnetv6/>
      <media/>
      <mediaopt/>
      <gateway/>
      <gatewayv6/>
    </lan>
    
    <lo0>
      <internal_dynamic>1</internal_dynamic>
      <descr>Loopback</descr>
      <enable>1</enable>
      <if>lo0</if>
      <ipaddr>127.0.0.1</ipaddr>
      <ipaddrv6>::1</ipaddrv6>
      <subnet>8</subnet>
      <subnetv6>128</subnetv6>
      <type>none</type>
      <virtual>1</virtual>
    </lo0>
    
    <opt1>
      <if>{{ opnsense.opt1_interface }}</if>
      <enable>1</enable>
      <ipaddr>{{ bmc_network.gateway }}</ipaddr>
      <subnet>{{ bmc_network.cidr | regex_replace('^/', '') }}</subnet>
      <gateway/>
      <ipaddrv6/>
      <subnetv6/>
      <gatewayv6/>
    </opt1>
  </interfaces>

  <!-- DHCP Configuration -->
  <dhcpd>
    <lan>
      <enable>1</enable>
      <gateway>{{ mgmt_network.gateway }}</gateway>
      <ddnsdomainalgorithm>hmac-md5</ddnsdomainalgorithm>
      <numberoptions>
        <item/>
      </numberoptions>
      <range>
        <from>{{ mgmt_network.network }}.16</from>
        <to>{{ mgmt_network.network }}.21</to>
      </range>
      <winsserver/>
      <dnsserver>{{ mgmt_network.gateway }}</dnsserver>
      <ntpserver/>
{% for mapping in opnsense.dhcp_static_maps %}
      <staticmap>
        <mac>{{ mapping.mac }}</mac>
        <ipaddr>{{ mapping.ip }}</ipaddr>
        <hostname>{{ mapping.hostname }}</hostname>
        <descr>{{ mapping.description }}</descr>
        <gateway>{{ mapping.gateway }}</gateway>
        <winsserver/>
        <dnsserver>{{ mapping.dns }}</dnsserver>
        <ntpserver/>
      </staticmap>
{% endfor %}
    </lan>
  </dhcpd>

  <!-- SNMP Configuration -->
  <snmpd>
    <syslocation/>
    <syscontact/>
    <rocommunity>public</rocommunity>
  </snmpd>

  <!-- NAT Rules -->
  <nat>
    <outbound>
      <mode>automatic</mode>
    </outbound>
{% for forward in opnsense.port_forwards %}
    <rule>
      <protocol>{{ forward.protocol }}</protocol>
      <interface>wan</interface>
      <category/>
      <ipprotocol>inet</ipprotocol>
      <descr>{{ forward.descr }}</descr>
      <tag/>
      <tagged/>
      <poolopts/>
      <associated-rule-id>nat_{{ ansible_date_time.epoch }}_{{ loop.index }}</associated-rule-id>
      <target>{{ forward.target }}</target>
      <local-port>{{ forward.local_port }}</local-port>
      <source>
        <any>1</any>
      </source>
      <destination>
        <network>(self)</network>
        <port>{{ forward.wan_port }}</port>
      </destination>
      <updated>
        <username>ansible@automated</username>
        <time>{{ ansible_date_time.epoch }}</time>
        <description>Generated by Ansible</description>
      </updated>
      <created>
        <username>ansible@automated</username>
        <time>{{ ansible_date_time.epoch }}</time>
        <description>Generated by Ansible</description>
      </created>
    </rule>
{% endfor %}
  </nat>

  <!-- Firewall Filter Rules -->
  <filter>
    <!-- WAN WebGUI Access -->
    <rule uuid="{{ 999999999999 | random | to_uuid }}">
      <type>pass</type>
      <interface>wan</interface>
      <ipprotocol>inet</ipprotocol>
      <statetype>keep state</statetype>
      <direction>in</direction>
      <quick>1</quick>
      <protocol>tcp</protocol>
      <source>
        <any>1</any>
      </source>
      <destination>
        <network>(self)</network>
        <port>{{ opnsense.webgui_port }}</port>
      </destination>
      <updated>
        <username>ansible@automated</username>
        <time>{{ ansible_date_time.epoch }}</time>
        <description>Generated by Ansible</description>
      </updated>
      <created>
        <username>ansible@automated</username>
        <time>{{ ansible_date_time.epoch }}</time>
        <description>Generated by Ansible</description>
      </created>
    </rule>

{% for forward in opnsense.port_forwards %}
    <!-- Port Forward Rule: {{ forward.descr }} -->
    <rule uuid="{{ 999999999999 | random | to_uuid }}">
      <associated-rule-id>nat_{{ ansible_date_time.epoch }}_{{ loop.index }}</associated-rule-id>
      <source>
        <any>1</any>
      </source>
      <interface>wan</interface>
      <statetype>keep state</statetype>
      <protocol>{{ forward.protocol }}</protocol>
      <ipprotocol>inet</ipprotocol>
      <destination>
        <address>{{ forward.target }}</address>
        <port>{{ forward.local_port }}</port>
      </destination>
      <descr>{{ forward.descr }}</descr>
      <category/>
      <created>
        <username>ansible@automated</username>
        <time>{{ ansible_date_time.epoch }}</time>
        <description>Generated by Ansible</description>
      </created>
    </rule>
{% endfor %}

    <!-- Default LAN Rules -->
    <rule uuid="{{ 999999999999 | random | to_uuid }}">
      <type>pass</type>
      <ipprotocol>inet</ipprotocol>
      <descr>Default allow LAN to any rule</descr>
      <interface>lan</interface>
      <source>
        <network>lan</network>
      </source>
      <destination>
        <any/>
      </destination>
    </rule>
    
    <rule uuid="{{ 999999999999 | random | to_uuid }}">
      <type>pass</type>
      <ipprotocol>inet6</ipprotocol>
      <descr>Default allow LAN IPv6 to any rule</descr>
      <interface>lan</interface>
      <source>
        <network>lan</network>
      </source>
      <destination>
        <any/>
      </destination>
    </rule>
    
    <!-- OPT1 NTP Rule -->
    <rule uuid="{{ 999999999999 | random | to_uuid }}">
      <type>pass</type>
      <interface>opt1</interface>
      <ipprotocol>inet</ipprotocol>
      <statetype>keep state</statetype>
      <descr>OPT1 NTP Server</descr>
      <direction>in</direction>
      <quick>1</quick>
      <protocol>udp</protocol>
      <source>
        <network>opt1</network>
      </source>
      <destination>
        <network>(self)</network>
        <port>123</port>
      </destination>
      <updated>
        <username>ansible@automated</username>
        <time>{{ ansible_date_time.epoch }}</time>
        <description>Generated by Ansible</description>
      </updated>
      <created>
        <username>ansible@automated</username>
        <time>{{ ansible_date_time.epoch }}</time>
        <description>Generated by Ansible</description>
      </created>
    </rule>
  </filter>

  <!-- RRD -->
  <rrd>
    <enable/>
  </rrd>

  <!-- NTP Configuration -->
  <ntpd>
    <prefer>{{ ntp.server }}</prefer>
    <iburst>{{ ntp.server }}</iburst>
  </ntpd>

  <!-- Widgets -->
  <widgets>
    <sequence>system_information-container:00000000-col3:show,services_status-container:00000001-col4:show,gateways-container:00000002-col4:show,interface_list-container:00000003-col4:show</sequence>
    <column_count>2</column_count>
  </widgets>

  <!-- Revision -->
  <revision>
    <username>ansible@automated</username>
    <time>{{ ansible_date_time.epoch }}</time>
    <description>Generated by Ansible automation</description>
  </revision>

  <!-- OPNsense Configuration -->
  <OPNsense>
    <DHCRelay version="1.0.1"/>
    <wireguard>
      <client version="1.0.0">
        <clients/>
      </client>
      <general version="0.0.1">
        <enabled>0</enabled>
      </general>
      <server version="1.0.0">
        <servers/>
      </server>
    </wireguard>
    <IPsec version="1.0.1">
      <general>
        <enabled/>
      </general>
      <keyPairs/>
      <preSharedKeys/>
    </IPsec>
    <Swanctl version="1.0.0">
      <Connections/>
      <locals/>
      <remotes/>
      <children/>
      <Pools/>
      <VTIs/>
      <SPDs/>
    </Swanctl>
    <OpenVPNExport version="0.0.1">
      <servers/>
    </OpenVPNExport>
    <OpenVPN version="1.0.0">
      <Overwrites/>
      <Instances/>
      <StaticKeys/>
    </OpenVPN>
    <captiveportal version="1.0.2">
      <zones/>
      <templates/>
    </captiveportal>
    <cron version="1.0.4">
      <jobs/>
    </cron>
    <Firewall>
      <Lvtemplate version="0.0.1">
        <templates/>
      </Lvtemplate>
      <Alias version="1.0.1">
        <geoip>
          <url/>
        </geoip>
        <aliases/>
      </Alias>
      <Category version="1.0.0">
        <categories/>
      </Category>
      <Filter version="1.0.4">
        <rules/>
        <snatrules/>
        <npt/>
        <onetoone/>
      </Filter>
    </Firewall>
    <Netflow version="1.0.1">
      <capture>
        <interfaces/>
        <egress_only/>
        <version>v9</version>
        <targets/>
      </capture>
      <collect>
        <enable>0</enable>
      </collect>
      <activeTimeout>1800</activeTimeout>
      <inactiveTimeout>15</inactiveTimeout>
    </Netflow>
    <IDS version="1.0.9">
      <rules/>
      <policies/>
      <userDefinedRules/>
      <files/>
      <fileTags/>
      <general>
        <enabled>0</enabled>
        <ips>0</ips>
        <promisc>0</promisc>
        <interfaces>wan</interfaces>
        <homenet>192.168.0.0/16,10.0.0.0/8,172.16.0.0/12</homenet>
        <defaultPacketSize/>
        <UpdateCron/>
        <AlertLogrotate>W0D23</AlertLogrotate>
        <AlertSaveLogs>4</AlertSaveLogs>
        <MPMAlgo/>
        <detect>
          <Profile/>
          <toclient_groups/>
          <toserver_groups/>
        </detect>
        <syslog>0</syslog>
        <syslog_eve>0</syslog_eve>
        <LogPayload>0</LogPayload>
        <verbosity/>
      </general>
    </IDS>
    <Interfaces>
      <loopbacks version="1.0.0"/>
      <neighbors version="1.0.0"/>
      <vxlans version="1.0.2"/>
    </Interfaces>
    <Kea>
      <ctrl_agent version="0.0.1">
        <general>
          <enabled>0</enabled>
          <http_host>127.0.0.1</http_host>
          <http_port>8000</http_port>
        </general>
      </ctrl_agent>
      <dhcp4 version="1.0.0">
        <general>
          <enabled>0</enabled>
          <interfaces/>
          <valid_lifetime>4000</valid_lifetime>
          <fwrules>1</fwrules>
        </general>
        <ha>
          <enabled>0</enabled>
          <this_server_name/>
        </ha>
        <subnets/>
        <reservations/>
        <ha_peers/>
      </dhcp4>
    </Kea>
    <monit version="1.0.13">
      <general>
        <enabled>0</enabled>
        <interval>120</interval>
        <startdelay>120</startdelay>
        <mailserver>127.0.0.1</mailserver>
        <port>25</port>
        <username/>
        <password/>
        <ssl>0</ssl>
        <sslversion>auto</sslversion>
        <sslverify>1</sslverify>
        <logfile/>
        <statefile/>
        <eventqueuePath/>
        <eventqueueSlots/>
        <httpdEnabled>0</httpdEnabled>
        <httpdUsername>root</httpdUsername>
        <httpdPassword/>
        <httpdPort>2812</httpdPort>
        <httpdAllow/>
        <mmonitUrl/>
        <mmonitTimeout>5</mmonitTimeout>
        <mmonitRegisterCredentials>1</mmonitRegisterCredentials>
      </general>
      <alert uuid="007b6add-3cdb-4082-9121-2bb435f2ef95">
        <enabled>0</enabled>
        <recipient>root@localhost.local</recipient>
        <noton>0</noton>
        <events/>
        <format/>
        <reminder/>
        <description/>
      </alert>
      <service uuid="f773deb0-8ccf-47f0-92b9-9d7ce7f89b60">
        <enabled>1</enabled>
        <name>$HOST</name>
        <description/>
        <type>system</type>
        <pidfile/>
        <match/>
        <path/>
        <timeout>300</timeout>
        <starttimeout>30</starttimeout>
        <address/>
        <interface/>
        <start/>
        <stop/>
        <tests>671c6227-0b46-430a-80a5-cf5f7f358b0e,e89eafdb-0f0b-4c64-8714-f75bc55bda17,8ff38b03-0e8f-492e-8866-fdb1b3b133c5,f373131f-312a-4d1c-9421-48dcfd0bf39c</tests>
        <depends/>
        <polltime/>
      </service>
      <service uuid="41deceaa-d0ed-497a-a0c8-cf83117c0e52">
        <enabled>1</enabled>
        <name>RootFs</name>
        <description/>
        <type>filesystem</type>
        <pidfile/>
        <match/>
        <path>/</path>
        <timeout>300</timeout>
        <starttimeout>30</starttimeout>
        <address/>
        <interface/>
        <start/>
        <stop/>
        <tests>828ce76d-8a6d-4cf1-8f8f-d21fdfad4215</tests>
        <depends/>
        <polltime/>
      </service>
      <service uuid="26cec860-e81d-4abb-bff9-ca8ecad06028">
        <enabled>0</enabled>
        <name>carp_status_change</name>
        <description/>
        <type>custom</type>
        <pidfile/>
        <match/>
        <path>/usr/local/opnsense/scripts/OPNsense/Monit/carp_status</path>
        <timeout>300</timeout>
        <starttimeout>30</starttimeout>
        <address/>
        <interface/>
        <start/>
        <stop/>
        <tests>588874b9-928c-40af-8513-852c67878df3</tests>
        <depends/>
        <polltime/>
      </service>
      <service uuid="455a0f48-6bb3-40a3-9dac-8b926267d1c0">
        <enabled>0</enabled>
        <name>gateway_alert</name>
        <description/>
        <type>custom</type>
        <pidfile/>
        <match/>
        <path>/usr/local/opnsense/scripts/OPNsense/Monit/gateway_alert</path>
        <timeout>300</timeout>
        <starttimeout>30</starttimeout>
        <address/>
        <interface/>
        <start/>
        <stop/>
        <tests>f8062081-af2f-4d53-85c4-3c83c19105ce</tests>
        <depends/>
        <polltime/>
      </service>
      <test uuid="7dc8b6f9-f46e-4364-93d7-d57c6f5ba84e">
        <name>Ping</name>
        <type>NetworkPing</type>
        <condition>failed ping</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="541b782f-6e9c-458d-80c8-ccb7c36f5bb0">
        <name>NetworkLink</name>
        <type>NetworkInterface</type>
        <condition>failed link</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="820b821f-7bad-4ec2-9eed-caf43ac029ca">
        <name>NetworkSaturation</name>
        <type>NetworkInterface</type>
        <condition>saturation is greater than 75%</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="671c6227-0b46-430a-80a5-cf5f7f358b0e">
        <name>MemoryUsage</name>
        <type>SystemResource</type>
        <condition>memory usage is greater than 75%</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="e89eafdb-0f0b-4c64-8714-f75bc55bda17">
        <name>CPUUsage</name>
        <type>SystemResource</type>
        <condition>cpu usage is greater than 75%</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="8ff38b03-0e8f-492e-8866-fdb1b3b133c5">
        <name>LoadAvg1</name>
        <type>SystemResource</type>
        <condition>loadavg (1min) is greater than 8</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="f373131f-312a-4d1c-9421-48dcfd0bf39c">
        <name>LoadAvg5</name>
        <type>SystemResource</type>
        <condition>loadavg (5min) is greater than 6</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="6355baa0-d4fd-4c20-ab17-ac5be3ed1751">
        <name>LoadAvg15</name>
        <type>SystemResource</type>
        <condition>loadavg (15min) is greater than 4</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="828ce76d-8a6d-4cf1-8f8f-d21fdfad4215">
        <name>SpaceUsage</name>
        <type>SpaceUsage</type>
        <condition>space usage is greater than 75%</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="588874b9-928c-40af-8513-852c67878df3">
        <name>ChangedStatus</name>
        <type>ProgramStatus</type>
        <condition>changed status</condition>
        <action>alert</action>
        <path/>
      </test>
      <test uuid="f8062081-af2f-4d53-85c4-3c83c19105ce">
        <name>NonZeroStatus</name>
        <type>ProgramStatus</type>
        <condition>status != 0</condition>
        <action>alert</action>
        <path/>
      </test>
    </monit>
    
    <!-- Gateways -->
    <Gateways version="1.0.0">
      <gateway_item uuid="{{ 999999999999 | random | to_uuid }}">
        <disabled>0</disabled>
        <name>WAN_GW</name>
        <descr>Interface WAN Gateway</descr>
        <interface>wan</interface>
        <ipprotocol>inet</ipprotocol>
        <gateway>{{ customer_network.gateway }}</gateway>
        <defaultgw>1</defaultgw>
        <fargw>1</fargw>
        <monitor_disable>1</monitor_disable>
        <monitor_noroute/>
        <monitor/>
        <force_down/>
        <priority>255</priority>
        <weight>1</weight>
        <latencylow/>
        <latencyhigh/>
        <losslow/>
        <losshigh/>
        <interval/>
        <time_period/>
        <loss_interval/>
        <data_length/>
      </gateway_item>
    </Gateways>
    
    <!-- Syslog -->
    <Syslog version="1.0.2">
      <general>
        <enabled>1</enabled>
        <loglocal>1</loglocal>
        <maxpreserve>31</maxpreserve>
        <maxfilesize/>
      </general>
      <destinations/>
    </Syslog>
    
    <!-- Traffic Shaper -->
    <TrafficShaper version="1.0.3">
      <pipes/>
      <queues/>
      <rules/>
    </TrafficShaper>
    
    <!-- Unbound DNS -->
    <unboundplus version="1.0.9">
      <general>
        <enabled>1</enabled>
        <port>53</port>
        <stats/>
        <active_interface/>
        <dnssec>0</dnssec>
        <dns64>0</dns64>
        <dns64prefix/>
        <noarecords>0</noarecords>
        <regdhcp>0</regdhcp>
        <regdhcpdomain/>
        <regdhcpstatic>0</regdhcpstatic>
        <noreglladdr6>0</noreglladdr6>
        <noregrecords>0</noregrecords>
        <txtsupport>0</txtsupport>
        <cacheflush>0</cacheflush>
        <local_zone_type>static</local_zone_type>
        <outgoing_interface/>
        <enable_wpad>0</enable_wpad>
      </general>
      <advanced>
        <hideidentity/>
        <hideversion/>
        <prefetch/>
        <prefetchkey/>
        <dnssecstripped/>
        <aggressivensec>1</aggressivensec>
        <serveexpired/>
        <serveexpiredreplyttl/>
        <serveexpiredttl/>
        <serveexpiredttlreset/>
        <serveexpiredclienttimeout/>
        <qnameminstrict/>
        <extendedstatistics/>
        <logqueries/>
        <logreplies/>
        <logtagqueryreply/>
        <logservfail/>
        <loglocalactions/>
        <logverbosity>1</logverbosity>
        <valloglevel>0</valloglevel>
        <privatedomain/>
        <privateaddress>0.0.0.0/8,10.0.0.0/8,100.64.0.0/10,169.254.0.0/16,172.16.0.0/12,192.0.2.0/24,192.168.0.0/16,198.18.0.0/15,198.51.100.0/24,203.0.113.0/24,233.252.0.0/24,::1/128,2001:db8::/32,fc00::/8,fd00::/8,fe80::/10</privateaddress>
        <insecuredomain/>
        <msgcachesize/>
        <rrsetcachesize/>
        <outgoingnumtcp/>
        <incomingnumtcp/>
        <numqueriesperthread/>
        <outgoingrange/>
        <jostletimeout/>
        <cachemaxttl/>
        <cachemaxnegativettl/>
        <cacheminttl/>
        <infrahostttl/>
        <infrakeepprobing/>
        <infracachenumhosts/>
        <unwantedreplythreshold/>
      </advanced>
      <acls>
        <default_action>allow</default_action>
      </acls>
      <dnsbl>
        <enabled>0</enabled>
        <safesearch/>
        <type/>
        <lists/>
        <whitelists/>
        <blocklists/>
        <wildcards/>
        <address/>
        <nxdomain/>
      </dnsbl>
      <forwarding>
        <enabled/>
      </forwarding>
      <dots/>
      <hosts>
{% for host in opnsense.dns_hosts %}
        <host uuid="{{ 999999999999 | random | to_uuid }}">
          <enabled>1</enabled>
          <hostname>{{ host.hostname }}</hostname>
          <domain>{{ domain_name }}</domain>
          <rr>A</rr>
          <mxprio/>
          <mx/>
          <server>{{ host.ip }}</server>
          <description>{{ host.description }}</description>
        </host>
{% endfor %}
{% if opnsense.dns_wildcards is defined %}
{% for wildcard in opnsense.dns_wildcards %}
        <host uuid="{{ 999999999999 | random | to_uuid }}">
          <enabled>1</enabled>
          <hostname>{{ wildcard.hostname }}</hostname>
          <domain>{{ wildcard.domain }}</domain>
          <rr>A</rr>
          <mxprio/>
          <mx/>
          <server>{{ wildcard.ip }}</server>
          <description>{{ wildcard.description }}</description>
        </host>
{% endfor %}
{% endif %}
      </hosts>
      <aliases/>
      <domains/>
    </unboundplus>
  </OPNsense>
  
  <!-- HA Sync -->
  <hasync version="1.0.0">
    <disablepreempt>0</disablepreempt>
    <disconnectppps>0</disconnectppps>
    <pfsyncenabled>0</pfsyncenabled>
    <pfsyncinterface>lan</pfsyncinterface>
    <pfsyncpeerip/>
    <pfsyncversion>1400</pfsyncversion>
    <synchronizetoip/>
    <username/>
    <password/>
    <syncitems/>
  </hasync>
  
  <!-- OpenVPN -->
  <openvpn/>
  
  <!-- Interface Groups -->
  <ifgroups version="1.0.0"/>
  
  <!-- GIF Tunnels -->
  <gifs version="1.0.0">
    <gif/>
  </gifs>
  
  <!-- GRE Tunnels -->
  <gres version="1.0.0">
    <gre/>
  </gres>
  
  <!-- Link Aggregation -->
  <laggs version="1.0.0">
    <lagg/>
  </laggs>
  
  <!-- Virtual IPs -->
  <virtualip version="1.0.0">
    <vip/>
  </virtualip>
  
  <!-- VLANs -->
  <vlans version="1.0.0">
    <vlan/>
  </vlans>
  
  <!-- Static Routes -->
  <staticroutes version="1.0.0">
    <route/>
  </staticroutes>
  
  <!-- Bridges -->
  <bridges>
    <bridged/>
  </bridges>
  
  <!-- PPP -->
  <ppps>
    <ppp/>
  </ppps>
  
  <!-- Wireless -->
  <wireless>
    <clone/>
  </wireless>
  
  <!-- Certificate Authorities -->
  <ca/>
  
  <!-- DHCPv6 -->
  <dhcpdv6/>
  
  <!-- Certificate (Keep existing from original config) -->
  <cert uuid="cb12cf71-da78-40d1-a2e0-a722713342c7">
    <refid>67293f300ae55</refid>
    <descr>Web GUI TLS certificate</descr>
    <caref/>
    <crt>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUhIakNDQlFhZ0F3SUJBZ0lVSFJ4emFFNWdNRzh6Q2p3VUZiMW5QRVdKcS8wd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2dZa3hIVEFiQmdOVkJBTU1GRTlRVG5ObGJuTmxMbXh2WTJGc1pHOXRZV2x1TVFzd0NRWURWUVFHRXdKTwpUREVWTUJNR0ExVUVDQXdNV25WcFpDMUliMnhzWVc1a01SVXdFd1lEVlFRSERBeE5hV1JrWld4b1lYSnVhWE14CkxUQXJCZ05WQkFvTUpFOVFUbk5sYm5ObElITmxiR1l0YzJsbmJtVmtJSGRsWWlCalpYSjBhV1pwWTJGMFpUQWUKRncweU5ERXhNRFF5TVRRd01ERmFGdzB5TlRFeU1EWXlNVFF3TURGYU1JR0pNUjB3R3dZRFZRUUREQlJQVUU1egpaVzV6WlM1c2IyTmhiR1J2YldGcGJqRUxNQWtHQTFVRUJoTUNUa3d4RlRBVEJnTlZCQWdNREZwMWFXUXRTRzlzCmJHRnVaREVWTUJNR0ExVUVCd3dNVFdsa1pHVnNhR0Z5Ym1sek1TMHdLd1lEVlFRS0RDUlBVRTV6Wlc1elpTQnoKWld4bUxYTnBaMjVsWkNCM1pXSWdZMlZ5ZEdsbWFXTmhkR1V3Z2dJaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQwpEd0F3Z2dJS0FvSUNBUURhRHpWcWVjcFMyYVNadzQ4OU1OS1dGRzYwKzRyQyt2MEliaTJhSlJvZDRFSjRud1pnCndzNVVNUFBobHFUL25iWHJXTDF0dlJ5MFhyK1pYN3AxVjRzZnFaMldaQmsxY3BtNnNJS3VIU1BRSkJFc2ZRQ2wKcVMxeStIdE5XZ0c2dW1qRjZnZzJUV2dLQW90Y2lCcUErTC9wZmZOWlNwSlBRZVlYcTR1UCtnTDMrK1hwNDJaUwpLTmlTL2xocDRZSlZLaVBIT3RnTTZvTEliN0tNUVNpaHVPeCtwcUhpek80QTN1K1JROWxzTVZzMWNhU0U3S2dlCk4yOUlHN3FZckxIVVlvOElxSVRtUjhXMEh5RmtuT0xnTHVtOXRpeE4xK2F6ZkxreDltNzRnZnBxNXVUQjhOaHcKbWd3eG5zQldVMUZvNzZSNERGaUhTWjNBY21kVTFpMkQ5T1NNMHlTQ2lFZnNpb3RQVUx2MC9kbk5ZSC95dW1FQwo0bFNRMkdyd0taQ1lVUmhwK2tTaHhlVHRrWXYycjNBNC96WmhvN1JOZVp2aW8vZFBLdGdnc2g0dVNwMUNRSE53CkN1bnoxRkl3d1Q3d0FBbWwxb2NMYVUzbHdlUEMxVnZ5dzVDUDIwc0tBNGttandmTjZmUy9LNDgxUW92UVExcW8KZ0NzWHYyb1lEOGxFOTNzYXA2YzF4dnZMY0tXV1JWT1VCR202NWY5TWdWOWVtVWU4d3dBc1NUTlRkenFnNmpPRQpndGRzVkxYam9ncExuL1IzYSs3OTJWN1RsZSs1RFkxb243TlhhRHFjcXlEMEdYd2Z4aGhuK3NsK24xeVgxZ3ZvCkNxRkJHUVRzN3A3aVpITHNja2FSUllvelNiVGJFQWtMM3NldWh3V1l6RXJSMnF3NDNzVkxDanBzMlFJREFRQUIKbzRJQmVqQ0NBWFl3Q1FZRFZSMFRCQUl3QURBUkJnbGdoa2dCaHZoQ0FRRUVCQU1DQmtBd05BWUpZSVpJQVliNApRZ0VOQkNjV0pVOVFUbk5sYm5ObElFZGxibVZ5WVhSbFpDQlRaWEoyWlhJZ1EyVnlkR2xtYVdOaGRHVXdIUVlEClZSME9CQllFRkRsMG9mWVJCREZEZG9VUVNhS2FPWUpNdFRsak1JR3pCZ05WSFNNRWdhc3dnYWloZ1kra2dZd3cKZ1lreEhUQWJCZ05WQkFNTUZFOVFUbk5sYm5ObExteHZZMkZzWkc5dFlXbHVNUXN3Q1FZRFZRUUdFd0pPVERFVgpNQk1HQTFVRUNBd01XblZwWkMxSWIyeHNZVzVrTVJVd0V3WURWUVFIREF4TmFXUmtaV3hvWVhKdWFYTXhMVEFyCkJnTlZCQW9NSkU5UVRuTmxibk5sSUhObGJHWXRjMmxuYm1Wa0lIZGxZaUJqWlhKMGFXWnBZMkYwWllJVUhSeHoKYUU1Z01HOHpDandVRmIxblBFV0pxLzB3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQ0FJQwpNQXNHQTFVZER3UUVBd0lGb0RBZkJnTlZIUkVFR0RBV2doUlBVRTV6Wlc1elpTNXNiMk5oYkdSdmJXRnBiakFOCkJna3Foa2lHOXcwQkFRc0ZBQU9DQWdFQWVabXh2SE03WDZDYXV5SnZ2ZGZpelRmNzRzOTBNcW5STmJkM05YT1YKME4yVGRDcklVb25YR3ZGSUNXM2lNcytxT3JaUTdrc0QvTW9PSVUxZTVNRTFGSkJRM3l3WTVtNGtCb1YxblNHTwo3eUFTQk53SVZNS1FRL3llclQwWWJoaFpPZHJhUWdsNzFDVWVQQ3N6YUVTZkJUSkxwTTFyVHJuTEVDblQrb3hZCmdzSU4wR2REOXVFOWpyZ3ZHQ2c0aW84aHJRZ1Y0c1VCN3JyVHVUdW5WMVlGOWExUWI0M1VaMVB2SCsycUg2eEcKVVAvdXZFUGhjbm14aGNlWlpNazNsZ2FHOHJjT1ZqbHg4WjdtUm9OaE9TOWVDaGZYd3hGdlNyNEg5ZytJR2d2bQo0dWx1SjhPOW44UHZLTldObm9NK2M2NUNPSUs2d0VOc0tRTlZxS3VPbE44Um5ldU8vM2dNUWF4cFVvRktyY2xhCmhrNTYrRDY3VzJMT21tcVZLb1FzYmlBblJyVnhvbEl4Yk04V0s2UTNmTE9heFpFRW9lQjNRMmRYajJCTFhhNy8Kbi96S3VZbkJUZjlyK3hIeDlHcE1tQlZiRE9sZXhqU3IxVndBK1h3UDhodjNCbUdSdFFsWmhsaC8yNTJKaTI2TworZysxMHk5VndDT2x1KzVIZW5HR204aC9MZnpING0ybXZVbVdVOHBBbWY4RkQzL2dqUkdFbkp3bnN0Q2lVY25qCmtUQk9NVHJoakp5bTM0VitPWi9GRFlMN0FiWW5aZEhLWW9LeVpkblFKQzBxOUgzUTVzSXlyZjNnV20vaE5wZzUKck4wUUJBWHc0Mjkzb0w1WGZMZjFtbXhqY2RhRUh4K0NWMDlvV0VudExtQjBCSUU3ODdIWGI4cnFkYm9LblBMVgp6alk9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</crt>
    <csr/>
    <prv>LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpSQUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1M0d2dna3FBZ0VBQW9JQ0FRRGFEelZxZWNwUzJhU1oKdzQ4OU1OS1dGRzYwKzRyQyt2MEliaTJhSlJvZDRFSjRud1pnd3M1VU1QUGhscVQvbmJYcldMMXR2UnkwWHIrWgpYN3AxVjRzZnFaMldaQmsxY3BtNnNJS3VIU1BRSkJFc2ZRQ2xxUzF5K0h0TldnRzZ1bWpGNmdnMlRXZ0tBb3RjCmlCcUErTC9wZmZOWlNwSlBRZVlYcTR1UCtnTDMrK1hwNDJaU0tOaVMvbGhwNFlKVktpUEhPdGdNNm9MSWI3S00KUVNpaHVPeCtwcUhpek80QTN1K1JROWxzTVZzMWNhU0U3S2dlTjI5SUc3cVlyTEhVWW84SXFJVG1SOFcwSHlGawpuT0xnTHVtOXRpeE4xK2F6ZkxreDltNzRnZnBxNXVUQjhOaHdtZ3d4bnNCV1UxRm83NlI0REZpSFNaM0FjbWRVCjFpMkQ5T1NNMHlTQ2lFZnNpb3RQVUx2MC9kbk5ZSC95dW1FQzRsU1EyR3J3S1pDWVVSaHAra1NoeGVUdGtZdjIKcjNBNC96WmhvN1JOZVp2aW8vZFBLdGdnc2g0dVNwMUNRSE53Q3VuejFGSXd3VDd3QUFtbDFvY0xhVTNsd2VQQwoxVnZ5dzVDUDIwc0tBNGttandmTjZmUy9LNDgxUW92UVExcW9nQ3NYdjJvWUQ4bEU5M3NhcDZjMXh2dkxjS1dXClJWT1VCR202NWY5TWdWOWVtVWU4d3dBc1NUTlRkenFnNmpPRWd0ZHNWTFhqb2dwTG4vUjNhKzc5MlY3VGxlKzUKRFkxb243TlhhRHFjcXlEMEdYd2Z4aGhuK3NsK24xeVgxZ3ZvQ3FGQkdRVHM3cDdpWkhMc2NrYVJSWW96U2JUYgpFQWtMM3NldWh3V1l6RXJSMnF3NDNzVkxDanBzMlFJREFRQUJBb0lDQUFDbmNvNEdzYXI2TkI5MXUrV3lHMUlWCnFEeFYrUUYvc1F3NWwwMU1ITTIvYmFzaXNBKzBlTzJ6SE44Z1JtdWVjeVRGM2M1d0VXMm8wZGE5d09vZjdHMEIKaGZCR1dtdjhJRTJTOW5YSnNaUTJhTmYvbFpLRWhUTlRWT1Zrc3JCUjdUeE10R3ZGZW5XekJ1ZVBZdTluOUJkZwp0RjJ3d2JnQmc0aVB3TWprc1B6MVZNL1JGQkloUUJZUEp0TkFoWlZ0VGhqNnVtSG94cUpOdTZ1Q3VSQytYT0xpClJTOVFTRmdRQ09SY2phK0Z5QjVkQ1ZsVEVLcW5pWGJrY1hzZStDeEpxaUx4U1l1SEVkRXAvRE9OZkRqTGdEQ3AKVVA4RDRXd3NFOWJWODk0MmczcUhsUnNjNGhtUUt3MDBvZGlka0dVdnV6S0toMkVjOHdoVnR1QjhJQUVqQXVueQo4cFhWVjZSRHJtZnhwUUc2S01pMGVnb2ZYbFpYbTZvaENnNlVlc09Dc1Z3RWhRcnpMa2kyNCtGbGx3cmExbGw1CkIzek9aU1RLZEw2cEs1bURNekFQekNLM1JSSE1qQ0x3cXc4ZEwvYXlpbWxRY0YwYmlWcE9laEkyRStCa0RpZUgKSjNUTlYySjJpMTNTVU5PY1FITFlVQWhERjJnRTBkS3VnZjhFc2RmblJ6cXY5b3owbXY3U0RtMlpTWHhMMG1OSQp6dTVybE1NbXRXZ0djN3dCUXRBRGNkMXdDTnJXWUk5MVYxZklWazZ2MjZsNDhNVjcvbkRXWXNpSDBVamptVXdTCmNpbFljbmROaTROak9rVS9CSXk5U0VpVm1xenQ1N3NZMUN6RVZ6Nm5EZi96OEsvNk5VU08rc0tzZTdLb2cyYzgKV2EwRjZVZDc3Nm9hN05kbHM4b3hBb0lCQVFENHNzQ1IrVVhUVzd4TEtLWmhMem5odGp3UjNqV0xkTjJvWXVoSQpxYWJTYnArL01XNGtXeWs4TFViTml2eXNYVVRjT0xkc29sTVMzVFlsM1ZRaGZ4bHpOc2x4NTF1S1poY3BhNFV3CnpMRU9Kb0laNmhQdVFTZEVLODBzSm9CZG5nT1Npb2VvNVU4blFMZjJjRnY0T1dhWEkwQUs0WEJiVEg4L2RyTm0KR0dubE9MY1F0SEp5bVlESjlTSGRoY0l2aStxY1dXOU0zMFFFNjJGNm9iUFhEM29IOHE2clhsOFFUZmhBQS9nNApyVk1ITUJDc0lEOWxQSlhYRXNMRDhXdEljNWRwcERhZkdhRzhxNUtwWlRMbzV2VnoxaHNuRStTVWtrZUdZc1JHCkdGYmJ5Y2NjT3kzNmo1bVVROUFXM1NBZXJyYmtxVC9DU1IxdUJ4aXZqaEoyK1ZZcEFvSUJBUURnZGl2Rm1ObXgKdkVZcmFUZHY4OWRCazdSS2JMY2FiYUM2M0lSN0lsTkFhcHJabTg2RHB6ZDZheXhDSWJTRk5vSTM3OXNLS3lsbwpJRlZCRnhza2NCZzJ5VGovS21UNG5QV1VhMGZNVTNzWWxBZG4veUNYaVNmYkFkdURmN3AyS3A0M3gwUWtrMDl3CnN0V3lMN2I0RHdxa2RVWUlydjBBY3p6YW5YOExob3h0WGVRM0JaR3pOaXVyTFY4WnhtRXl0UFJSck52a3BvZWcKcG9vNjlvbFVMM1dpZzFUaVFvME9vZHoxK3VsWTlJQWJXYW01K1o3SWFHUVB5OHY0WlNNc003a0NyYXJ1TmtFVwpUQTd6VGU4Y0NOMUVBT29acXVqNnNvOFRqeEVxUTkzQVVMQXBNNXhQaGdKYWRsVUlnbitHekJQOFd5dmY4cXVFClBLSHU0OFZEa1ZjeEFvSUJBUURtZHQrMVprYXF3c3dPNmpDa3h0cmdxN3VtNDBERFp4MHh1ZFovMzVkVVVtZC8KQ2hPRFpXY2srT0F3QWFoOUlrRjV3cVZYNm1VSmlpMXZrVmN4WTFMMlRjTUg1dG9SdXVHajVKdWN5Vk1hUmQweQpucFN4cVhiMTJaRmNaS0Y0SDhJM3ZtQlF4NDgrVk44bFpLSVZ1VHUwdTFuUnUzQWZheGhRZTNOc0hSdWs2NVhaCnlSNTF6SUpvcE4wcEo1YjM4TFVOQm1QNTNMeHZ3cUNtdjhxa2RSY2szbU8zTXREdGp4T0tYeU5iZ21MNnVqUDUKRGpreFc1K1BtemNaMVZNUjVPeGZYV213cmxRUFB2KytNcVdtNXNCM0ErWk5wRVdpMkp1bmtVZEpuYXlBS05CMgovUEJ5elRnSkNYNkFjWkllWE5IbnZGLzFiMFB5Zm1rRjVxWjkwamxoQW9JQkFRQ1EwKzZlU21kOFJNekp5ZFBaClNtNURnN2c2cFRibnVJQ1MwU0l5Q1EzS2JINkpsZnlEK2VyVDlEN1VWTWNUaFA0MGRYRFJlTlA0dVpRSXNZM3oKenRmdzBaa1RHeG1YU0Q4MGlwd0MvSUphYzNqcjR6UDJVcXNDcG9vcXFNbDQ0VHJCSnJPVEhmR045L1htU044Mwo0d3lzM0haWnQvN0t3WkFzUnA3b291SU0xeDRmV2xxT1ZZK0xuWFRWUHFrTWZMRi8yWmJ3UzNzTGJ5bVZyZWtpCkJwVlNUSWNDam9wUlBLTkRtNmZnbTdIazg4K05qY0NqOHFkTmdlT1QzRDM3a1V2NHJIR3p6aEhrL3lKT1hxUy8KWkFEUWxmNTJuVTVDSStBcGNKQlV3d0ZieXpRL0FXd0Q2Nld0Rk5qODZxYTZKUWRvTnJOeWhqT2cyVFpxMjFBMgpycHFoQW9JQkFRQ3c4R21NV1luZjBnWDJ0WTJMajBQdEJVWEJ1UGg3Sk11bEN3UEtCT0tKZHplRnQzUWl6KzNMCm80V1R2LzB0L25ORDllQ2pIYm53cnp0UEpMUWtsYTlPNitVMUp5djJNTDNNTXRnT1lveUNGRGJLa0lleTdvSjQKY1VZWlVBa3l6OVd2aUdHZFd0Z1ppWGJBKy9LdDNSa3ZzdkkvVEc5MDRMa0hxUUJuYk1yZ01FRWZ6TmU1bFNuRApiUFN3TDBxYjBXTUlYTklvUVpOSkVud1FyL09rQWxBNE1ETUFkUVczL3ZVOERTWHFCK0dVL3pod0xOYjJyRktTClZMdTE1aE5TY0xQNGNSMW5MZmlZMTluZ2xDQmxKQ0pjTFFEZXB3Vm5YYms1T2NRY0drbWRJOFNBaXJKYm5zbnoKUy9XeGQyUUFBRnBpU1FvL0x0Ym1LNTNNOThmc3U0TDgKLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo=</prv>
  </cert>
  
  <!-- Syslog -->
  <syslog/>
</opnsense>