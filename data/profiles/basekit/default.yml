- id: Copy SSH Key to mgmt_kvm
  kind: ansible
  file: "tasks/common/copy_ssh_key.yml"
  args:
      - "-e env_name={env}"
      - "-e target_hosts=mgmt_kvm"
      - "-e ssh_pubkey_path=/install/usr_home/{env}/.ssh/onboarder_ssh_key.pub"

#- id: Preflight Checks
#  kind: python3
#  file: "tasks/basekit/preflight.py"

- id: Bootstrap Mgmt KVM
  kind: ansible
  file: "tasks/basekit/bootstrap-mgmt-kvm.yml"

- id: Deploy VMs
  kind: ansible
  file: "tasks/basekit/deploy-vms.yml"

# OPNSense is already configured from the saved config directory.
# Will need to do this if things change
#- id: Configure OPNsense
#  kind: ansible
#  file: "tasks/basekit-configure-opnsense.yml"

- id: Deploy OPNsense
  kind: python3
  file: "tasks/basekit/deploy-opnsense.py"