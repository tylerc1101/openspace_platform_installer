# ==============================================================================
# Environment Taskfile - GENERATED FILE
# ==============================================================================
# ⚠️  DO NOT EDIT THIS FILE MANUALLY
#
# This file is GENERATED from: deployment.yml
# To make changes:
#   1. Edit deployment.yml
#   2. Run: task prep-config
#   3. This file will be regenerated
#
# Generated: {{ ansible_date_time.iso8601 }}
# Deployment: {{ deployment.name }}
# ==============================================================================

{% set data_dir = "/docker-workspace/data" %}

version: '3'

includes:
  main:
    taskfile: '{{ data_dir }}/onboarders/{{ deployment.onboarder_version }}/main.yml'
    vars:
      DATA_DIR: '{{ data_dir }}'
      ONBOARDER_DIR: '{{ data_dir }}/onboarders/{{ deployment.onboarder_version }}'
      INSTALL_DIR: '{{ install_dir }}'
      DEPLOYMENT_TYPE: '{{ deployment.type }}'

tasks:
  # ============================================================================
  # Deployment Tasks
  # ============================================================================
  deploy-infra:
    desc: "Deploys {{ deployment.type }} infrastructure"
    cmds:
      - task: main:deploy-infra

  deploy-mcm:
    desc: "Deploy MCM (Management Cluster Manager)"
    cmds:
      - task: main:deploy-mcm
        vars:
          HOSTS: management_cluster
      #- task: main:get-kubeconfig-mcm

  deploy-osms:
    desc: "Deploy OSMS (OpenSpace Management System)"
    cmds:
      - task: main:deploy-osms
        vars:
          HOSTS: openspace_management_system
      #- task: deployment:get-kubeconfig-osms

  deploy-osdc:
    desc: "Deploy OSDC (OpenSpace Data Cluster)"
    cmds:
      - task: main:deploy-osdc
        vars:
          HOSTS: openspace_datapath_cluster
      #- task: deployment:get-kubeconfig-osdc

  deploy-post-osdc:
    desc: "Post-OSDC deployment tasks"
    cmds:
      - task: main:deploy-post-osdc
        vars:
          HOSTS: openspace_datapath_cluster

  deploy-opscenter:
    desc: "Deploy OpenSpace Tooling"
    cmds:
      - task: main:deploy-opscenter

  deploy-all:
    desc: "Deploy all clusters (MCM → OSMS → OSDC)"
    cmds:
      - task: deploy-infra
      - task: deploy-mcm
      - task: deploy-osms
      - task: deploy-osdc

  # ============================================================================
  # Destroy Tasks
  # ============================================================================
  destroy-mcm:
    desc: "Destroy MCM (Management Cluster Manager)"
    cmds:
      - task: main:destroy-mcm
        vars:
          HOSTS: management_cluster
      #- task: main:get-kubeconfig-mcm

  destroy-osms:
    desc: "Destroy OSMS (OpenSpace Management System)"
    cmds:
      - task: main:destroy-osms
        vars:
          HOSTS: openspace_management_system
      #- task: deployment:get-kubeconfig-osms

  destroy-osdc:
    desc: "Destroy OSDC (OpenSpace Data Cluster)"
    cmds:
      - task: main:destroy-osdc
        vars:
          HOSTS: openspace_datapath_cluster
      #- task: deployment:get-kubeconfig-osdc

  destroy-opscenter:
    desc: "Runs clean all task in the OpenSpace Tooling"
    cmds:
      - task: main:destroy-opscenter

  # ============================================================================
  # Kubeconfig Tasks
  # ============================================================================
  get-kubeconfig-mcm:
    desc: "Retrieve MCM kubeconfig file"
    cmds:
      - task: main:get-kubeconfig-mcm

  get-kubeconfig-osms:
    desc: "Retrieve OSMS kubeconfig file"
    cmds:
      - task: main:get-kubeconfig-osms

  get-kubeconfig-osdc:
    desc: "Retrieve OSDC kubeconfig file"
    cmds:
      - task: main:get-kubeconfig-osdc

  # ============================================================================
  # Cleanup Tasks
  # ============================================================================
  clean:
    desc: "Clean up deployment artifacts"
    cmds:
      - task: deploy:clean

  clean-config:
    desc: "Remove all generated configuration files"
    prompt: "This will delete all generated config files. Continue?"
    cmds:
      - rm -f config.yml
      - rm -f Taskfile.yml
      - rm -rf group_vars/
      - rm -rf host_vars/
      - rm -rf .cache/generated/
      - echo "✓ Generated configuration files removed"
      - echo "Run 'task prep-config' to regenerate"

  # ============================================================================
  # Utility Tasks
  # ============================================================================
  shell:
    desc: "Open a shell in the onboarder container"
    cmds:
      - task: deploy:shell

  logs:
    desc: "Show deployment logs"
    cmds:
      - cat .cache/state.json | python3 -m json.tool

  help:
    desc: "Show this help message"
    cmds:
      - task --list

# ==============================================================================
# Common Commands Quick Reference
# ==============================================================================
#
# Configuration:
#   task prep-config         - Regenerate configs from deployment.yml
#   task validate-config     - Validate generated configs
#   task show-config         - Show config summary
#
# Deployment:
#   task prep                - Complete environment preparation
#   task deploy-mcm          - Deploy MCM cluster
#   task deploy-osms         - Deploy OSMS cluster
#   task deploy-osdc         - Deploy OSDC cluster
#   task deploy-all          - Deploy all clusters
#
# Utilities:
#   task shell               - Open container shell
#   task logs                - View logs
#   task clean               - Clean deployment artifacts
#
# ==============================================================================
