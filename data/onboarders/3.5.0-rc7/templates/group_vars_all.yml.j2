# ==============================================================================
# Global Variables - GENERATED FILE
# ==============================================================================
# ⚠️  DO NOT EDIT THIS FILE MANUALLY
#
# This file is GENERATED from: deployment.yml
# To make changes:
#   1. Edit deployment.yml
#   2. Run: task prep-config
#   3. This file will be regenerated
#
# Generated: {{ ansible_date_time.iso8601 }}
# ==============================================================================

{% set data_dir = "/docker-workspace/data" %}
{% set config_dir = "/docker-workspace/config" %}
{% set install_dir = config_dir + "/install" %}
{% set cache_dir = install_dir + "/.cache" %}

# ==============================================================================
# Deployment Information
# ==============================================================================
deployment_name: "{{ deployment.name }}"
deployment_type: "{{ deployment.type }}"
onboarder_version: "{{ deployment.onboarder_version }}"
osms_tooling_version: "{{ deployment.osms_tooling_version }}"

# ==============================================================================
# Domain Configuration
# ==============================================================================
domain_name: "{{ domain.base }}"

# ==============================================================================
# Network Configuration
# ==============================================================================

# Customer Network (WAN)
customer_gateway: "{{ networks.customer.gateway }}"
customer_cidr: "{{ networks.customer.cidr }}"
customer_dns_servers: {{ networks.customer.dns_servers | to_json }}

# Management Network
mgmt_network: "{{ networks.management.network }}"
mgmt_cidr: "{{ networks.management.cidr }}"
mgmt_gateway: "{{ networks.management.gateway }}"
mgmt_dns_servers: {{ networks.management.dns_servers | to_json }}

# iDRAC Network
idrac_network: "{{ networks.idrac.network }}"
idrac_cidr: "{{ networks.idrac.cidr }}"
idrac_gateway: "{{ networks.idrac.gateway }}"

# ==============================================================================
# Cluster Configuration
# ==============================================================================

# Management Cluster (MCM)
{% if management_cluster is defined and management_cluster.clusters is defined %}
{% for cluster in management_cluster.clusters %}
mcm_cluster_name: "{{ cluster.cluster_name }}"
mcm_nodes:
{% for node in cluster.nodes %}
  - name: "{{ node.name }}"
    mgmt_ip: "{{ node.mgmt_ip }}"
{% endfor %}
{% endfor %}
{% endif %}

# OpenSpace Management System (OSMS)
{% if openspace_management_system is defined and openspace_management_system.clusters is defined %}
{% for cluster in openspace_management_system.clusters %}
osms_cluster_name: "{{ cluster.cluster_name }}"
{% if cluster.deployment_yaml is defined %}
osms_deployment_yaml: "{{ cluster.deployment_yaml }}"
{% endif %}
osms_nodes:
{% for node in cluster.nodes %}
  - name: "{{ node.name }}"
    mgmt_ip: "{{ node.mgmt_ip }}"
{% endfor %}
{% endfor %}
{% endif %}

# OpenSpace Data Cluster (OSDC)
{% if openspace_datapath_cluster is defined and openspace_datapath_cluster.clusters is defined %}
{% for cluster in openspace_datapath_cluster.clusters %}
osdc_cluster_name: "{{ cluster.cluster_name }}"
{% if cluster.deployment_yaml is defined %}
osdc_deployment_yaml: "{{ cluster.deployment_yaml }}"
{% endif %}
osdc_nodes:
{% for node in cluster.nodes %}
  - name: "{{ node.name }}"
    mgmt_ip: "{{ node.mgmt_ip }}"
{% if node.mac_address is defined %}
    mac_address: "{{ node.mac_address }}"
{% endif %}
{% endfor %}
{% endfor %}
{% endif %}

# ==============================================================================
# NTP Configuration
# ==============================================================================
ntp_server: "{{ ntp.server }}"
ntp_timezone: "{{ ntp.timezone }}"

# ==============================================================================
# Storage Configuration
# ==============================================================================
{% if storage is defined %}
{% if storage.nfs is defined %}
# NFS Storage
nfs_enabled: {{ storage.nfs.enabled | default(false) | lower }}
{% if storage.nfs.enabled | default(false) %}
nfs_server: "{{ storage.nfs.server }}"
nfs_path: "{{ storage.nfs.path }}"
{% endif %}
{% endif %}
{% endif %}

# ==============================================================================
# Onboarder Directory Paths
# ==============================================================================
config_dir: "/docker-workspace/config"
install_dir: "{{ config_dir }}/install"
sample_vsphere_dir: "{{ config_dir }}/sample-vsphere"
cache_dir: "{{ install_dir }}/.cache"
common_dir: "{{ config_dir }}/common"

image_dir: "/docker-workspace/images"
data_dir: "/docker-workspace/data"
onboarder_dir: "{{ data_dir }}/onboarders/{{ deployment.onboarder_version }}"

# ==============================================================================
# VIRTUAL IP ADDRESSES
# ==============================================================================
# These VIPs are used for cluster access and load balancing
vips:
  osdc: "{{ networks.management.network }}.249"                  # OSDC ingress VIP
  osms: "{{ networks.management.network }}.250"                  # OSMS ingress VIP
  api_osdc: "{{ networks.management.network }}.251"              # OSDC Kubernetes API VIP
  api_osms: "{{ networks.management.network }}.252"              # OSMS Kubernetes API VIP
  api_mcm: "{{ networks.management.network }}.253"               # MCM Rancher API VIP
  mcm_wildcard: "{{ networks.management.network }}.254"          # MCM wildcard DNS VIP

# ==============================================================================
# Virtual Machine Configuration
# ==============================================================================
{% if virtual_machines is defined %}
{% if virtual_machines.mcm is defined %}
vm_mcm_name: "{{ virtual_machines.mcm.name }}"
vm_mcm_memory: {{ virtual_machines.mcm.memory }}
vm_mcm_vcpus: {{ virtual_machines.mcm.vcpus }}
vm_mcm_disk_size: {{ virtual_machines.mcm.disk_size }}
vm_mcm_backing_store: "{{ virtual_machines.mcm.backing_store }}"
vm_mcm_os_variant: "{{ virtual_machines.mcm.os_variant }}"
vm_mcm_network_bridge: "{{ virtual_machines.mcm.network_bridge }}"
{% endif %}

{% if virtual_machines.osms is defined %}
vm_osms_name: "{{ virtual_machines.osms.name }}"
vm_osms_memory: {{ virtual_machines.osms.memory }}
vm_osms_vcpus: {{ virtual_machines.osms.vcpus }}
vm_osms_disk_size: {{ virtual_machines.osms.disk_size }}
vm_osms_backing_store: "{{ virtual_machines.osms.backing_store }}"
vm_osms_os_variant: "{{ virtual_machines.osms.os_variant }}"
vm_osms_network_bridge: "{{ virtual_machines.osms.network_bridge }}"
{% endif %}
{% endif %}