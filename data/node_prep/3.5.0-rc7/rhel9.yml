version: '3'

tasks:
  node-prep:
    desc: Cluster Node Prep
    requires:
      vars: [HOSTS]
    cmds:
      - python3 {{.DATA_DIR}}/run_task.py 
          --task-id=configure-node 
          --hosts={{.HOSTS}} 
          --file={{.DATA_DIR}}/node_prep/{{.ONBOARDER_VERSION}}/tasks/configure-node.yml 
          --kind=ansible

  install-rke2-selinux:
    desc: Install RKE2 SELinux Package
    requires:
      vars: [HOSTS]
    cmds:
      - python3 {{.DATA_DIR}}/run_task.py 
          --task-id=install-rke2-selinux 
          --hosts={{.HOSTS}} 
          --file={{.DATA_DIR}}/node_prep/{{.ONBOARDER_VERSION}}/tasks/install_rke2-selinux.yml 
          --kind=ansible

  deploy-all:
    desc: Run All Node Prep Tasks
    requires:
      vars: [HOSTS]
    cmds:
      - task: node-prep
        vars:
          HOSTS: '{{.HOSTS}}'
      - task: install-rke2-selinux
        vars:
          HOSTS: '{{.HOSTS}}'