---
- name: Deploy Downstream Clusters
  hosts: localhost
  gather_facts: false
  vars:
    # Get the list of clusters to deploy from inventory
    clusters_list: "{{ hostvars['localhost']['clusters_to_deploy'] }}"
    env_dir: "/docker-workspace/config/{{ env_name }}"
  
  tasks:
    - name: Display clusters to deploy
      ansible.builtin.debug:
        msg: "Clusters to deploy: {{ clusters_list }}"

    - name: Process each downstream cluster
      include_tasks: deploy_single_cluster.yml
      loop: "{{ clusters_list }}"
      loop_control:
        loop_var: cluster_group_name